<!DOCTYPE html>
<!--
    äººå·¥æ™ºèƒ½å·¥å…·ï¼šPowerPointå­¦ä¹ æ™ºèƒ½ä½“
    ä½œè€…: MYJ
    æè¿°: ä¸€ä¸ªåŸºäºAIçš„PPTå­¦ä¹ åŠ©æ‰‹ï¼Œæä¾›äº¤äº’å¼å­¦ä¹ ä½“éªŒï¼Œå¸®åŠ©ç”¨æˆ·æŒæ¡PPTè®¾è®¡ä¸æ¼”ç¤ºæŠ€èƒ½
    ç‰¹æ€§:
      - é›†æˆå¤šç§AIæ¨¡å‹æ”¯æŒå¤æ‚é—®é¢˜è§£ç­”
      - æ”¯æŒå›¾ç‰‡å’Œæ–‡ä»¶ä¸Šä¼ è¾…åŠ©é—®é¢˜è¯´æ˜
      - å®æ—¶æµå¼å“åº”æ˜¾ç¤º
      - æ•°å­—äººå¤´åƒåŠ¨ç”»æ•ˆæœ
      - å¯¹è¯å†å²è®°å½•ä¿å­˜ä¸å›çœ‹
      - å¸¸è§é—®é¢˜å¿«é€Ÿè®¿é—®
      - å“åº”å¼è®¾è®¡é€‚é…å¤šç§è®¾å¤‡
-->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¢¨è€å¸ˆ PPT å­¦ä¹ æ™ºèƒ½ä½“ - æ±•å¤´æŠ€å¸ˆå­¦é™¢</title>
    <style>
        /* 
         * é‡ç½®é»˜è®¤æ ·å¼
         * ç»Ÿä¸€å„æµè§ˆå™¨å…ƒç´ çš„é»˜è®¤æ ·å¼å·®å¼‚
         */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /*
         * é¡µé¢ä¸»ä½“æ ·å¼
         * è®¾ç½®åŸºæœ¬å­—ä½“ã€èƒŒæ™¯è‰²å’Œæœ€å°é«˜åº¦
         */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            padding: 0;
        }

        /*
         * å®¹å™¨å¸ƒå±€
         * ä½¿ç”¨Flexå¸ƒå±€å®ç°ä¸‰æ ç»“æ„
         */
        .container {
            display: flex;
            width: 100vw;
            height: 100vh;
            min-height: 100vh;
        }

        /* 
         * å·¦ä¾§å¯¹è¯è®°å½•è¾¹æ 
         * ç”¨äºæ˜¾ç¤ºå†å²å¯¹è¯è®°å½•çš„å‚ç›´è¾¹æ 
         */
        .left-sidebar {
            width: 120px;
            padding: 10px;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
            overflow-y: auto;
            position: relative;
            transition: all 0.3s ease;
        }

        /*
         * å†å²è®°å½•é¡¹æ ·å¼
         * å•ä¸ªå†å²å¯¹è¯è®°å½•çš„æ˜¾ç¤ºæ ·å¼
         */
        .history-item {
            width: 100%;
            min-height: 40px;
            margin: 5px 0;
            border-radius: 4px;
            background: #F5670F;
            display: flex;
            align-items: center;
            padding: 5px 10px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-item:hover {
            background: #e05c0d;
        }

        /* 
         * å·¦ä¾§è¾¹æ æŠ˜å çŠ¶æ€
         * é»˜è®¤éšè—ä¾§è¾¹æ ï¼Œåªæ˜¾ç¤ºè¾¹ç¼˜ä»¥ä¾¿è§¦å‘
         */
        .left-sidebar.collapsed {
            width: 10px;
            padding: 10px 0;
        }

        .left-sidebar.collapsed .history-item {
            display: none;
        }

        /* 
         * å·¦ä¾§è¾¹æ æ‚¬åœå±•å¼€
         * é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºå®Œæ•´ä¾§è¾¹æ 
         */
        .left-sidebar:hover {
            width: 180px;
        }

        .left-sidebar:hover .history-item {
            display: flex;
        }

        /* 
         * å·¦ä¾§é¢æ¿
         * åŒ…å«Logoå’Œæ•°å­—äººå±•ç¤ºåŒºåŸŸ
         */
        .left-panel {
            width: 220px;
            padding: 20px;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        /*
         * Logoå®¹å™¨
         * å±…ä¸­æ˜¾ç¤ºå­¦æ ¡Logo
         */
        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        /*
         * æ•°å­—äººåŒºåŸŸ
         * å±•ç¤ºAIåŠ©æ‰‹çš„æ•°å­—äººå¤´åƒ
         */
        .digital-human {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }

        /*
         * æ•°å­—äººå¤´åƒå®¹å™¨
         * å›ºå®šé«˜åº¦å®¹å™¨ç”¨äºå±•ç¤ºå¤šå¼ å›¾ç‰‡
         */
        .digital-avatar-placeholder {
            width: 100%;
            height: 450px; 
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        /*
         * æ•°å­—äººå¤´åƒå›¾ç‰‡
         * å•å¼ å¤´åƒå›¾ç‰‡çš„åŸºç¡€æ ·å¼
         */
        .digital-avatar {
            max-width: 90%;
            max-height: 90%;
            width: auto;
            height: auto;
            object-fit: contain;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            opacity: 0;
        }

        .digital-avatar.active {
            opacity: 1;
            background-color: transparent; /* æ¿€æ´»æ—¶èƒŒæ™¯é€æ˜ */
        }

        .avatar-placeholder-text {
            color: #888;
            font-size: 14px;
            text-align: center;
            padding: 20px;
            z-index: 10;
        }

        /* 
         * ç§»åŠ¨ç«¯é€‚é…
         * é’ˆå¯¹ä¸åŒå±å¹•å°ºå¯¸è°ƒæ•´æ•°å­—äººå¤´åƒé«˜åº¦
         */
        @media (max-width: 768px) {
            .digital-avatar-placeholder {
                height: 200px;
            }
        }

        @media (max-width: 576px) {
            .digital-avatar-placeholder {
                height: 150px;
            }
        }
        
        /* é’ˆå¯¹Samsung Galaxy A51/71ç­‰è®¾å¤‡çš„ç²¾ç¡®é€‚é… */
        @media screen and (max-width: 412px) and (max-height: 914px) {
            .digital-avatar-placeholder {
                height: 70px;
            }
        }
        
        /* é’ˆå¯¹ç±»ä¼¼å°ºå¯¸çš„æ‰‹æœºè®¾å¤‡ */
        @media screen and (max-width: 420px) and (max-height: 920px) {
            .digital-avatar-placeholder {
                height: 70px;
            }
        }

        /* 
         * ä¸­é—´èŠå¤©åŒºåŸŸ
         * ä¸»è¦çš„å¯¹è¯äº¤äº’åŒºåŸŸ
         */
        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            border-right: 1px solid #e0e0e0;
            min-width: 0;
            background: #ffffff;
        }

        /*
         * å¤´éƒ¨ä¿¡æ¯åŒºåŸŸ
         * æ˜¾ç¤ºå­¦æ ¡ä¿¡æ¯å’Œæ ‡é¢˜
         */
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        /*
         * å­¦æ ¡Logoæ ·å¼
         * åœ†å½¢èƒŒæ™¯çš„å­¦æ ¡æ ‡è¯†
         */
        .school-logo {
            width: 60px;
            height: 60px;
            background: #F5670F;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .school-info h1 {
            font-size: 22px;
            color: #333;
            margin-bottom: 5px;
        }

        .school-info p {
            color: #666;
            font-size: 14px;
        }

        /* 
         * èŠå¤©åŒºåŸŸ
         * æ˜¾ç¤ºå¯¹è¯æ¶ˆæ¯çš„æ»šåŠ¨åŒºåŸŸ
         */
        .chat-area {
            flex: 1;
            background: #ffffff;
            padding: 20px;
            margin-bottom: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border: 1px solid #e0e0e0;
        }

        /*
         * æ¶ˆæ¯æ ·å¼
         * ç”¨æˆ·å’ŒAIæ¶ˆæ¯çš„åŸºç¡€å¸ƒå±€
         */
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            max-width: 100%;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 6px;
            line-height: 1.6;
            word-wrap: break-word;
            font-size: 14px;
        }

        .message.ai .message-content {
            background: #fef3e8;
            color: #8c4600;
        }

        .message.user .message-content {
            background: #F5670F;
            color: white;
        }

        /* 
         * Markdown æ ·å¼
         * åœ¨æ¶ˆæ¯ä¸­æ¸²æŸ“Markdownå†…å®¹çš„æ ·å¼
         */
        .message-content h1 {
            font-size: 1.6em;
            font-weight: 600;
            margin: 16px 0 8px 0;
            color: inherit;
        }
        .message-content h2 {
            font-size: 1.4em;
            font-weight: 600;
            margin: 14px 0 7px 0;
            color: inherit;
        }
        .message-content h3 {
            font-size: 1.2em;
            font-weight: 600;
            margin: 12px 0 6px 0;
            color: inherit;
        }
        .message-content h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin: 10px 0 5px 0;
            color: inherit;
        }

        .message-content strong {
            font-weight: 600;
            color: inherit;
        }

        .message-content em {
            font-style: italic;
        }

        .message-content code {
            background: rgba(255, 255, 255, 0.5);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.95em;
            color: inherit;
        }

        .message-content pre {
            background: rgba(0, 0, 0, 0.8);
            color: #f0f0f0;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 12px 0;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .message-content pre code {
            background: transparent;
            padding: 0;
            color: #f0f0f0;
        }

        .message-content ul {
            list-style-type: disc;
            margin: 8px 0 8px 24px;
        }
        .message-content ol {
            list-style-type: decimal;
            margin: 8px 0 8px 24px;
        }
        .message-content li {
            margin-bottom: 4px;
        }

        .message-content a {
            color: #F5670F;
            text-decoration: underline;
        }
        .message.user .message-content a {
            color: #ffe0cc;
        }

        .message-image {
            max-width: 100%;
            border-radius: 8px;
            margin: 8px 0;
        }

        .file-description {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }

        /* 
         * è¾“å…¥åŒºåŸŸ
         * ç”¨æˆ·è¾“å…¥é—®é¢˜å’Œä¸Šä¼ æ–‡ä»¶çš„åŒºåŸŸ
         */
        .input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
        }

        .input-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
        }

        .tool-button {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            width: 100px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-button:hover {
            background: #e0e0e0;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            border: 1px solid #e0e0e0;
            outline: none;
            padding: 12px 16px;
            font-size: 14px;
            background: #ffffff;
            border-radius: 4px;
        }

        .send-btn {
            background: #F5670F;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .send-btn:hover {
            background: #e05c0d;
            transform: translateY(-1px);
        }

        .send-btn:disabled {
            background: #f7b58a;
            cursor: not-allowed;
            transform: none;
        }

        .send-btn.stop {
            background: #e53e3e;
        }

        .send-btn.stop:hover {
            background: #c53030;
        }

        /* 
         * å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
         * æ˜¾ç¤ºç”¨æˆ·å·²ä¸Šä¼ æ–‡ä»¶çš„åŒºåŸŸ
         */
        .uploaded-files {
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 10px;
            font-size: 13px;
            max-height: 120px;
            overflow-y: auto;
        }

        .uploaded-file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #e1e8ed;
        }

        .uploaded-file-item:last-child {
            border-bottom: none;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 500;
        }

        .file-desc-input {
            width: 100%;
            border: 1px solid #d1d9e6;
            border-radius: 4px;
            padding: 4px 6px;
            margin-top: 3px;
            font-size: 12px;
        }

        .remove-file {
            color: #e53e3e;
            cursor: pointer;
            font-size: 16px;
        }

        /* 
         * å³ä¾§è¾¹æ 
         * åŒ…å«æ¨¡å‹é€‰æ‹©ã€çŠ¶æ€ä¿¡æ¯å’Œå¸¸è§é—®é¢˜
         */
        .sidebar {
            width: 300px;
            padding: 20px;
            background: #f8f9fa;
            overflow-y: auto;
            border-left: 1px solid #e0e0e0;
        }

        .sidebar-section {
            padding: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .sidebar-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
        }

        .sidebar-section h3::before {
            margin-right: 8px;
        }

        .question-item {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            color: #666;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .question-item:hover {
            color: #F5670F;
        }

        .question-item:last-child {
            border-bottom: none;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            margin-right: 8px;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .loading {
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .loading.show {
            display: flex;
        }

        .loading-dots {
            display: flex;
            gap: 4px;
        }

        .loading-dot {
            width: 8px;
            height: 8px;
            background: #F5670F;
            border-radius: 50%;
            animation: loading 1.4s infinite;
        }

        .loading-dot:nth-child(2) { animation-delay: 0.2s; }
        .loading-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes loading {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* 
         * æ¨¡å‹é€‰æ‹©æ ·å¼
         * AIæ¨¡å‹é€‰æ‹©ä¸‹æ‹‰æ¡†æ ·å¼
         */
        .model-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .api-config {
            margin-top: 10px;
            display: none;
        }

        .api-config label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: #666;
        }

        .api-input {
            width: 100%;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            background: #ffffff;
        }

        .status-info {
            padding: 10px;
            background: #fef3e8;
            border-radius: 4px;
            font-size: 12px;
            color: #8c4600;
            margin-top: 10px;
        }

        /* 
         * éšè—æ–‡ä»¶è¾“å…¥
         * éšè—å®é™…çš„æ–‡ä»¶è¾“å…¥å…ƒç´ ï¼Œé€šè¿‡æŒ‰é’®è§¦å‘
         */
        #fileUpload {
            display: none;
        }

        /*
         * æ‰“å­—æŒ‡ç¤ºå™¨
         * AIæ­£åœ¨è¾“å…¥æ—¶çš„åŠ¨ç”»æ•ˆæœ
         */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            background: #fef3e8;
            padding: 8px 16px;
            border-radius: 4px;
            color: #8c4600;
            font-size: 14px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            background: #8c4600;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        /* 
         * å“åº”å¼è®¾è®¡
         * é’ˆå¯¹ä¸åŒå±å¹•å°ºå¯¸çš„é€‚é…æ ·å¼
         */
        @media (max-width: 1200px) {
            .left-panel {
                width: 250px;
            }
            .sidebar {
                width: 250px;
            }
        }

        @media (max-width: 992px) {
            .container {
                flex-direction: column;
            }
            
            .left-sidebar {
                display: none; /* ç§»åŠ¨ç«¯éšè—å¯¹è¯è®°å½•è¾¹æ  */
            }
            
            .left-panel, .sidebar, .main-chat {
                width: 100%;
                border-right: none;
            }
            
            .left-panel {
                order: -2;
                flex-direction: row;
                align-items: left;
                gap: 10px;
                padding: 10px;
                border-bottom: 1px solid #e0e0e0;
            }
            
            .logo-container {
                margin-bottom: 0;
                flex: 0 0 80%;
                margin-top: 10px;
            }
            
            .logo {
                max-width: 80%;
                height: auto;
            }
            
            .digital-human {
                flex: 1;
                flex-direction: row;
                justify-content: flex-end;
                gap: 5px;
                margin-top: 0;
            }
            
            .digital-avatar-placeholder {
                max-width: 80px;
                height: 80px;
                margin-bottom: 0;
            }
            
            .main-chat {
                order: -1;
                border-top: 1px solid #e0e0e0;
                border-bottom: 1px solid #e0e0e0;
            }
            
            /* ç§»åŠ¨ç«¯å³è¾¹æ è°ƒæ•´ */
            .sidebar {
                order: 0;
                min-height: 300px;
                max-height: 400px;
                overflow-y: auto;
            }
        }

        @media (max-width: 576px) {
            .left-panel {
                flex-direction: row;
                text-align: center;
                padding: 8px;
                gap: 8px;
            }
            
            .logo {
                max-width: 70%;
                height: auto;
            }
            
            .digital-human {
                flex-direction: row;
                justify-content: flex-end;
                gap: 3px;
            }
            
            .digital-avatar-placeholder {
                max-width: 70px;
                height: 70px;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            /* ç§»åŠ¨ç«¯å°å±å¹•å³è¾¹æ è°ƒæ•´ */
            .sidebar {
                min-height: 300px;
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§å¯¹è¯è®°å½•è¾¹æ  -->
        <div class="left-sidebar collapsed" id="historySidebar">
            <!-- å¯¹è¯è®°å½•é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
        </div>

        <!-- å·¦ä¾§æ  -->
        <div class="left-panel">
            <div class="logo-container">
                <a href="https://www.stjsxy.com" target="_blank">
                    <img src="https://www.stjsxy.com/template/1/default/_files/image/logo.png" alt="æ±•å¤´æŠ€å¸ˆå­¦é™¢ logo" class="logo">
                </a>
            </div>
            <div class="digital-human">
                <!-- æ•°å­—äººå›¾ç‰‡åŒºåŸŸï¼ŒåŒ…å«ä¸ƒå¼ å›¾ç‰‡ -->
                <div class="digital-avatar-placeholder">
                    <img src="3d1.png" alt="æ•°å­—äººè¡¨æƒ…1" class="digital-avatar" id="avatar1">
                    <img src="3d2.png" alt="æ•°å­—äººè¡¨æƒ…2" class="digital-avatar" id="avatar2">
                    <img src="3d3.png" alt="æ•°å­—äººè¡¨æƒ…3" class="digital-avatar" id="avatar3">
                    <img src="3d4.png" alt="æ•°å­—äººè¡¨æƒ…4" class="digital-avatar" id="avatar4">
                    <img src="3d5.png" alt="æ•°å­—äººè¡¨æƒ…5" class="digital-avatar" id="avatar5">
                    <img src="3d6.png" alt="æ•°å­—äººè¡¨æƒ…6" class="digital-avatar" id="avatar6">
                    <img src="3d7.png" alt="æ•°å­—äººè¡¨æƒ…7" class="digital-avatar" id="avatar7">
                    <div class="avatar-placeholder-text"></div>
                </div>
                
            </div>
        </div>

        <!-- ä¸­é—´èŠå¤©åŒºåŸŸ -->
        <div class="main-chat">
            <!-- å¤´éƒ¨ä¿¡æ¯ -->
            <div class="header">
                <div class="school-logo">å¢¨</div>
                <div class="school-info">
                    <h1>æ±•å¤´æŠ€å¸ˆå­¦é™¢ AI å­¦ä¹ åŠ©æ‰‹</h1>
                    <p>å¢¨è€å¸ˆ PPT å­¦ä¹ æ™ºèƒ½ä½“ - æ‚¨çš„æ¼”ç¤ºè®¾è®¡ä¸åˆ¶ä½œä¼™ä¼´</p>
                </div>
            </div>

            <!-- èŠå¤©åŒºåŸŸ -->
            <div class="chat-area" id="chatArea">
                <div class="message ai">
                    <div class="message-content">
                        æˆ‘æ˜¯å¢¨è€å¸ˆï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æé—®é¢˜ï¼æ¬¢è¿æ¥åˆ° PPT å­¦ä¹ æ™ºèƒ½ä½“ï¼æˆ‘å°†å¸®åŠ©æ‚¨ä»é›¶åŸºç¡€å¼€å§‹ï¼Œç³»ç»ŸæŒæ¡PPTè®¾è®¡ä¸æ¼”ç¤ºæŠ€èƒ½ã€‚æ— è®ºæ˜¯è®¾è®¡åŸåˆ™ã€åŠ¨ç”»æ•ˆæœè¿˜æ˜¯æ¼”è®²æŠ€å·§ï¼Œéƒ½å¯ä»¥éšæ—¶å‘æˆ‘æé—®ï¼æ‚¨è¿˜å¯ä»¥ä¸Šä¼ å›¾ç‰‡å’Œæ–‡ä»¶å¹¶æ·»åŠ æè¿°æ¥è¾…åŠ©è¯´æ˜é—®é¢˜ã€‚
                    </div>
                </div>
            </div>

            <!-- åŠ è½½åŠ¨ç”» -->
            <div class="loading" id="loading">
                <div class="loading-dots">
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                    <div class="loading-dot"></div>
                </div>
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-area">
                <!-- å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ -->
                <div class="uploaded-files" id="uploadedFilesList" style="display: none;"></div>
                
                <div class="input-tools">
                    <button class="tool-button" id="uploadImageBtn" title="ä¸Šä¼ å›¾ç‰‡">ğŸ–¼ï¸ ä¸Šä¼ å›¾ç‰‡</button>
                    <button class="tool-button" id="uploadFileBtn" title="ä¸Šä¼ æ–‡ä»¶">ğŸ“ ä¸Šä¼ æ–‡ä»¶</button>
                    <input type="file" id="fileUpload" accept="image/*,application/pdf,.ppt,.pptx,.doc,.docx,.txt,.zip,.tar.gz" multiple>
                </div>
                <div class="input-wrapper">
                    <input type="text" class="input-field" id="messageInput" placeholder="è¯·è¾“å…¥æ‚¨çš„ PPT ç›¸å…³é—®é¢˜...">
                    <button class="send-btn" id="sendBtn">å‘é€</button>
                </div>
            </div>
        </div>

        <!-- å³ä¾§è¾¹æ  -->
        <div class="sidebar">
            <!-- æ¨¡å‹é€‰æ‹© -->
            <div class="sidebar-section">
                <h3 style="margin-bottom: 10px;">ğŸ¤– AI æ¨¡å‹é€‰æ‹©</h3>
                <select id="modelSelect" class="model-select">
                    <option value="deepseek-ai/DeepSeek-R1-0528-Qwen3-8B">DeepSeek-R1-0528-Qwen3-8B</option>
                    <option value="Qwen/Qwen3-8B">Qwen3-8B</option>
                    <option value="THUDM/GLM-4-9B-0414" selected>THUDM/GLM-4-9B-0414</option>
                    <option value="THUDM/GLM-4.1V-9B-Thinking">THUDM/GLM-4.1V-9B-Thinkingï¼ˆè§†è§‰ï¼‰</option>
                </select>
                <div class="api-config">
                    <label for="apiKey" >API å¯†é’¥:</label>
                    <input type="password" id="apiKey" class="api-input" placeholder="è¯·è¾“å…¥æ‚¨çš„ç¡…åŸºæµåŠ¨APIå¯†é’¥" value="sk-bqzzrraswxzmgexkmlqxuscwykiqkrswcljpbgdnwivcuwcg" style="display: none;">
                </div>
                <div class="status-info" id="modelInfo">
                    GLM-4-9B-0414: æ¸…åå¤§å­¦å›¢é˜Ÿå¼€å‘çš„90äº¿å‚æ•°æ¨¡å‹ï¼Œæ“…é•¿å¤æ‚é€»è¾‘æ¨ç†
                </div>
            </div>

            <!-- åœ¨çº¿çŠ¶æ€ -->
            <div class="sidebar-section">
                <h3 style="margin-bottom: 10px;">ğŸŸ¢ æœåŠ¡çŠ¶æ€</h3>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>å¢¨è€å¸ˆåœ¨çº¿ï¼Œéšæ—¶ä¸ºæ‚¨ç­”ç–‘</span>
                </div>
                <div style="font-size: 12px; color: #888;">
                    å¯¹æ¥ç¡…åŸºæµåŠ¨AIå¤§æ¨¡å‹
                </div>
            </div>

            <!-- å¸¸è§é—®é¢˜ -->
            <div class="sidebar-section">
                <h3>ğŸ“‹ PPT å¸¸è§é—®é¢˜</h3>
                <div class="question-item" onclick="askQuestion('å¦‚ä½•åˆ¶ä½œä¸€ä¸ªä¸“ä¸šçš„PPTæ¨¡æ¿ï¼Ÿ')">
                    å¦‚ä½•åˆ¶ä½œä¸€ä¸ªä¸“ä¸šçš„PPTæ¨¡æ¿ï¼Ÿ
                </div>
                <div class="question-item" onclick="askQuestion('PPTè®¾è®¡ä¸­æœ‰å“ªäº›é…è‰²åŸåˆ™ï¼Ÿ')">
                    PPTè®¾è®¡ä¸­æœ‰å“ªäº›é…è‰²åŸåˆ™ï¼Ÿ
                </div>
                <div class="question-item" onclick="askQuestion('å¦‚ä½•ä¸ºPPTæ·»åŠ æµç•…çš„åŠ¨ç”»æ•ˆæœï¼Ÿ')">
                    å¦‚ä½•ä¸ºPPTæ·»åŠ æµç•…çš„åŠ¨ç”»æ•ˆæœï¼Ÿ
                </div>
                <div class="question-item" onclick="askQuestion('PPTæ¼”è®²æœ‰å“ªäº›æŠ€å·§ï¼Ÿ')">
                    PPTæ¼”è®²æœ‰å“ªäº›æŠ€å·§ï¼Ÿ
                </div>
                <div class="question-item" onclick="askQuestion('å¦‚ä½•è®¾è®¡æœ‰å¸å¼•åŠ›çš„æ•°æ®å›¾è¡¨ï¼Ÿ')">
                    å¦‚ä½•è®¾è®¡æœ‰å¸å¼•åŠ›çš„æ•°æ®å›¾è¡¨ï¼Ÿ
                </div>
                <div class="question-item" onclick="askQuestion('PPTæ’ç‰ˆçš„åŸºæœ¬åŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ')">
                    PPTæ’ç‰ˆçš„åŸºæœ¬åŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ
                </div>
                <div class="question-item" onclick="askQuestion('å¦‚ä½•åœ¨PPTä¸­æœ‰æ•ˆä½¿ç”¨å›¾ç‰‡å’Œå›¾æ ‡ï¼Ÿ')">
                    å¦‚ä½•åœ¨PPTä¸­æœ‰æ•ˆä½¿ç”¨å›¾ç‰‡å’Œå›¾æ ‡ï¼Ÿ
                </div>
                <div class="question-item" onclick="askQuestion('å¦‚ä½•æ§åˆ¶PPTæ¼”ç¤ºçš„æ—¶é—´ï¼Ÿ')">
                    å¦‚ä½•æ§åˆ¶PPTæ¼”ç¤ºçš„æ—¶é—´ï¼Ÿ
                </div>
            </div>

            <!-- å­¦ä¹ æŒ‡å¯¼ -->
            <div class="sidebar-section">
                <h3 style="margin-bottom: 10px;">ğŸ¯ å­¦ä¹ å»ºè®®</h3>
                <div style="font-size: 14px; color: #666; line-height: 1.6;">
                    <p>â€¢ ä»åŸºç¡€è®¾è®¡åŸåˆ™å¼€å§‹å­¦ä¹ </p>
                    <p>â€¢ å¤šè§‚å¯Ÿä¼˜ç§€PPTæ¡ˆä¾‹</p>
                    <p>â€¢ åŠ¨æ‰‹å®è·µåˆ¶ä½œå®Œæ•´æ¼”ç¤º</p>
                    <p>â€¢ å¾ªåºæ¸è¿›ï¼Œæ³¨é‡ç»†èŠ‚</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * å…¨å±€å˜é‡å®šä¹‰
         * å­˜å‚¨åº”ç”¨çŠ¶æ€å’Œæ•°æ®
         */
        
        /**
         * ä¸Šä¸€æ¬¡AIå›å¤çš„å†…å®¹
         * @type {string}
         */
        let lastAiResponse = '';
        
        /**
         * æµå¼å“åº”çŠ¶æ€æ ‡è®°
         * æ ‡è¯†å½“å‰æ˜¯å¦æ­£åœ¨è¿›è¡Œæµå¼å“åº”
         * @type {boolean}
         */
        let isStreaming = false;
        
        /**
         * å½“å‰æµæ§åˆ¶å™¨
         * ç”¨äºä¸­æ­¢æ­£åœ¨è¿›è¡Œçš„æµå¼è¯·æ±‚
         * @type {AbortController|null}
         */
        let currentStreamController = null;
        
        /**
         * æ•°å­—äººå¤´åƒåˆ‡æ¢å®šæ—¶å™¨
         * æ§åˆ¶æ•°å­—äººå¤´åƒçš„åŠ¨ç”»æ’­æ”¾
         * @type {number|null}
         */
        let avatarInterval = null;
        
        /**
         * å½“å‰æ˜¾ç¤ºçš„å¤´åƒç´¢å¼•
         * æ ‡è¯†å½“å‰æ­£åœ¨æ˜¾ç¤ºçš„æ•°å­—äººå¤´åƒ
         * @type {number}
         */
        let currentAvatarIndex = 0;
        
        /**
         * å¯¹è¯å†å²è®°å½•
         * å­˜å‚¨ç”¨æˆ·ä¸AIçš„å¯¹è¯å†å²
         * @type {Array}
         */
        let conversationHistory = [];

        /**
         * é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
         * ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ï¼Œåˆå§‹åŒ–ç•Œé¢çŠ¶æ€
         */
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šäº‹ä»¶
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', e => {
                if (e.key === 'Enter') sendMessage();
            });
            document.getElementById('modelSelect').addEventListener('change', function() {
                document.getElementById('modelInfo').textContent = MODEL_INFO[this.value] || 'æœªçŸ¥æ¨¡å‹';
            });
            
            // åˆå§‹åŒ–æ˜¾ç¤ºç¬¬ä¸€å¼ å¤´åƒ
            showAvatar(0);
            
            // é¢„åŠ è½½æ‰€æœ‰æ•°å­—äººå›¾ç‰‡ï¼Œé¿å…åˆ‡æ¢æ—¶é—ªçƒ
            const avatarImages = [
                '3d1.png', '3d2.png', '3d3.png', 
                '3d4.png', '3d5.png', '3d6.png', '3d7.png'
            ];
            
            avatarImages.forEach(src => {
                const img = new Image();
                img.src = src;
            });
            
            // åˆå§‹åŒ–å¯¹è¯å†å²è®°å½•
            loadConversationHistory();
        });

        /**
         * ä¿å­˜å¯¹è¯åˆ°å†å²è®°å½•
         * å°†ç”¨æˆ·æ¶ˆæ¯å’ŒAIå›å¤ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
         * @param {string} userMessage - ç”¨æˆ·å‘é€çš„æ¶ˆæ¯
         * @param {string} aiResponse - AIçš„å›å¤
         */
        function saveToHistory(userMessage, aiResponse) {
            const conversation = {
                id: Date.now(),
                timestamp: new Date().toLocaleString('zh-CN'),
                userMessage: userMessage,
                aiResponse: aiResponse
            };
            
            conversationHistory.unshift(conversation);
            // é™åˆ¶å†å²è®°å½•æ•°é‡ä¸º20æ¡
            if (conversationHistory.length > 20) {
                conversationHistory = conversationHistory.slice(0, 20);
            }
            
            localStorage.setItem('pptAIHistory', JSON.stringify(conversationHistory));
            updateHistorySidebar();
        }

        /**
         * åŠ è½½å¯¹è¯å†å²è®°å½•
         * ä»æœ¬åœ°å­˜å‚¨ä¸­è¯»å–å¯¹è¯å†å²è®°å½•
         */
        function loadConversationHistory() {
            try {
                const history = localStorage.getItem('pptAIHistory');
                if (history) {
                    conversationHistory = JSON.parse(history);
                    updateHistorySidebar();
                }
            } catch (e) {
                console.error('åŠ è½½å¯¹è¯å†å²è®°å½•å¤±è´¥:', e);
                conversationHistory = [];
            }
        }

        /**
         * æ›´æ–°å†å²è®°å½•ä¾§è¾¹æ 
         * æ ¹æ®å¯¹è¯å†å²è®°å½•æ›´æ–°å·¦ä¾§è¾¹æ çš„æ˜¾ç¤ºå†…å®¹
         */
        function updateHistorySidebar() {
            const historySidebar = document.getElementById('historySidebar');
            historySidebar.innerHTML = '';
            
            conversationHistory.forEach((conversation, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.title = `${conversation.userMessage}\næ—¶é—´: ${conversation.timestamp}`;
                historyItem.innerHTML = `${conversation.userMessage.substring(0, 15)}${conversation.userMessage.length > 15 ? '...' : ''}`;
                historyItem.addEventListener('click', () => {
                    showConversation(conversation);
                });
                historySidebar.appendChild(historyItem);
            });
        }

        /**
         * æ˜¾ç¤ºå®Œæ•´å¯¹è¯å†…å®¹
         * ç‚¹å‡»å†å²è®°å½•æ—¶åœ¨èŠå¤©åŒºåŸŸæ˜¾ç¤ºå®Œæ•´çš„å¯¹è¯å†…å®¹
         * @param {Object} conversation - å¯¹è¯è®°å½•å¯¹è±¡
         */
        function showConversation(conversation) {
            // æ¸…ç©ºå½“å‰èŠå¤©åŒºåŸŸ
            const chatArea = document.getElementById('chatArea');
            chatArea.innerHTML = '';
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'message user';
            const userContentDiv = document.createElement('div');
            userContentDiv.className = 'message-content';
            userContentDiv.innerHTML = markdownToHtml(conversation.userMessage);
            userMessageDiv.appendChild(userContentDiv);
            chatArea.appendChild(userMessageDiv);
            
            // æ·»åŠ AIå›å¤
            const aiMessageDiv = document.createElement('div');
            aiMessageDiv.className = 'message ai';
            const aiContentDiv = document.createElement('div');
            aiContentDiv.className = 'message-content';
            aiContentDiv.innerHTML = markdownToHtml(conversation.aiResponse);
            aiMessageDiv.appendChild(aiContentDiv);
            chatArea.appendChild(aiMessageDiv);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        /**
         * æ˜¾ç¤ºæŒ‡å®šç´¢å¼•çš„å¤´åƒ
         * åˆ‡æ¢æ˜¾ç¤ºæŒ‡å®šç´¢å¼•çš„æ•°å­—äººå¤´åƒ
         * @param {number} index - è¦æ˜¾ç¤ºçš„å¤´åƒç´¢å¼•
         */
        function showAvatar(index) {
            // éšè—æ‰€æœ‰å¤´åƒ
            document.querySelectorAll('.digital-avatar').forEach(avatar => {
                avatar.classList.remove('active');
            });
            
            // æ˜¾ç¤ºæŒ‡å®šå¤´åƒ
            const avatars = [
                document.getElementById('avatar1'),
                document.getElementById('avatar2'),
                document.getElementById('avatar3'),
                document.getElementById('avatar4'),
                document.getElementById('avatar5'),
                document.getElementById('avatar6'),
                document.getElementById('avatar7')
            ];
            
            if (avatars[index]) {
                avatars[index].classList.add('active');
                currentAvatarIndex = index;
            }
        }

        /**
         * å¾ªç¯åˆ‡æ¢å¤´åƒï¼ˆå®šæ—¶åˆ‡æ¢ï¼‰
         * å¯åŠ¨å®šæ—¶å™¨å¾ªç¯åˆ‡æ¢æ•°å­—äººå¤´åƒï¼Œåˆ›å»ºåŠ¨ç”»æ•ˆæœ
         */
        function startAvatarAnimation() {
            // å…ˆåœæ­¢ä»»ä½•æ­£åœ¨è¿è¡Œçš„åŠ¨ç”»
            stopAvatarAnimation();
            
            // è®¾ç½®å®šæ—¶å™¨ï¼Œæ¯400æ¯«ç§’åˆ‡æ¢ä¸€æ¬¡å¤´åƒ
            avatarInterval = setInterval(() => {
                // è®¡ç®—ä¸‹ä¸€ä¸ªè¦æ˜¾ç¤ºçš„å¤´åƒç´¢å¼•ï¼ˆå¾ªç¯æ˜¾ç¤ºï¼‰
                const nextIndex = (currentAvatarIndex + 1) % 7;
                showAvatar(nextIndex);
            }, 400);
        }

        /**
         * åœæ­¢å¤´åƒåŠ¨ç”»
         * æ¸…é™¤å¤´åƒåˆ‡æ¢å®šæ—¶å™¨ï¼Œåœæ­¢åŠ¨ç”»æ•ˆæœ
         */
        function stopAvatarAnimation() {
            if (avatarInterval) {
                clearInterval(avatarInterval);
                avatarInterval = null;
            }
            // åœæ­¢åæ˜¾ç¤ºç¬¬ä¸€å¼ å¤´åƒ
            showAvatar(0);
        }

        /**
         * AIæ¨¡å‹ä¿¡æ¯æ˜ å°„è¡¨
         * å­˜å‚¨å„AIæ¨¡å‹çš„æè¿°ä¿¡æ¯
         * @constant {Object}
         */
        const MODEL_INFO = {
            "deepseek-ai/DeepSeek-R1-0528-Qwen3-8B": "DeepSeek-R1-0528-Qwen3-8B: ä¼˜åŒ–çš„PPTå­¦ä¹ æ¨¡å‹ï¼Œå“åº”è¿…é€Ÿ",
            "Qwen/Qwen3-8B": "Qwen3-8B: é«˜æ€§èƒ½é€šç”¨æ¨¡å‹ï¼Œé€‚åˆè®¾è®¡é—®é¢˜è§£ç­”",
            "THUDM/GLM-4-9B-0414": "GLM-4-9B-0414: æ¸…åå¤§å­¦å›¢é˜Ÿå¼€å‘çš„90äº¿å‚æ•°æ¨¡å‹ï¼Œæ“…é•¿å¤æ‚é€»è¾‘æ¨ç†",
            "THUDM/GLM-4.1V-9B-Thinking":"THUDM/GLM-4.1V-9B-Thinkingï¼ˆè§†è§‰ï¼‰: 90äº¿å‚æ•°æ¨¡å‹ï¼Œæ“…é•¿è§†è§‰æ¨ç†"
        };

        /**
         * Markdownè½¬HTML
         * å°†Markdownæ ¼å¼æ–‡æœ¬è½¬æ¢ä¸ºHTMLæ ¼å¼
         * @param {string} markdown - Markdownæ ¼å¼æ–‡æœ¬
         * @return {string} è½¬æ¢åçš„HTMLæ ¼å¼æ–‡æœ¬
         */
        function markdownToHtml(markdown) {
            let html = markdown;
            
            // å¤„ç†æ ‡é¢˜
            html = html.replace(/^#{6}\s(.*?)$/gm, '<h6>$1</h6>');
            html = html.replace(/^#{5}\s(.*?)$/gm, '<h5>$1</h5>');
            html = html.replace(/^#{4}\s(.*?)$/gm, '<h4>$1</h4>');
            html = html.replace(/^#{3}\s(.*?)$/gm, '<h3>$1</h3>');
            html = html.replace(/^#{2}\s(.*?)$/gm, '<h2>$1</h2>');
            html = html.replace(/^#{1}\s(.*?)$/gm, '<h1>$1</h1>');
            
            // å¤„ç†åŠ ç²—å’Œæ–œä½“
            html = html.replace(/(\*\*|__)(.*?)\1/g, '<strong>$2</strong>');
            html = html.replace(/(\*|_)(.*?)\1/g, '<em>$2</em>');
            
            // å¤„ç†ä»£ç å—
            html = html.replace(/```(\w+)?\n([\s\S]*?)```/g, function(match, lang, code) {
                const escapedCode = code
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
                return `<pre><code>${escapedCode}</code></pre>`;
            });
            
            // å¤„ç†è¡Œå†…ä»£ç 
            html = html.replace(/`(.*?)`/g, '<code>$1</code>');
            
            // å¤„ç†åˆ—è¡¨
            html = html.replace(/^- (.*?)$/gm, '<li>$1</li>');
            html = html.replace(/(<li>.*?<\/li>)\s+(?=<li>)/gs, '$1');
            html = html.replace(/(<li>.*?<\/li>)+/gs, '<ul>$&</ul>');
            
            html = html.replace(/^(\d+)\. (.*?)$/gm, '<li>$2</li>');
            html = html.replace(/(<li>.*?<\/li>)\s+(?=<li>)/gs, '$1');
            html = html.replace(/(<li>.*?<\/li>)+/gs, '<ol>$&</ol>');
            
            // å¤„ç†é“¾æ¥
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
            
            // å¤„ç†æ¢è¡Œ
            html = html.replace(/\n(?!<\/li>|<li>|<\/ul>|<\/ol>)/g, '<br>');
            
            return html;
        }

        /**
         * è·å–å½“å‰é€‰ä¸­çš„æ¨¡å‹
         * è¿”å›ç”¨æˆ·åœ¨ç•Œé¢ä¸­é€‰æ‹©çš„AIæ¨¡å‹
         * @return {string} å½“å‰é€‰ä¸­çš„æ¨¡å‹æ ‡è¯†
         */
        function getCurrentModel() {
            return document.getElementById('modelSelect').value;
        }

        /**
         * è·å–å½“å‰è¾“å…¥çš„APIå¯†é’¥
         * è¿”å›ç”¨æˆ·åœ¨ç•Œé¢ä¸­è¾“å…¥çš„APIå¯†é’¥
         * @return {string} å½“å‰è¾“å…¥çš„APIå¯†é’¥
         */
        function getCurrentApiKey() {
            return document.getElementById('apiKey').value.trim();
        }

        /**
         * å‘é€æ¶ˆæ¯
         * å¤„ç†ç”¨æˆ·å‘é€æ¶ˆæ¯çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬è°ƒç”¨AI APIå’Œæ˜¾ç¤ºå“åº”
         */
        async function sendMessage() {
            // å¦‚æœæ­£åœ¨æµå¼ä¼ è¾“ï¼Œç‚¹å‡»å‘é€æŒ‰é’®åˆ™ä¸­æ­¢è¯·æ±‚
            if (isStreaming) {
                if (currentStreamController) currentStreamController.abort();
                isStreaming = false;
                updateSendButtonState();
                return;
            }
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            const sendBtn = document.getElementById('sendBtn');
            
            // æ›´æ–°å‘é€æŒ‰é’®çŠ¶æ€
            sendBtn.disabled = true;
            sendBtn.textContent = 'åœæ­¢';
            sendBtn.classList.add('stop');
            isStreaming = true;
            
            try {
                // æ£€æŸ¥æ˜¯å¦æœ‰è¾“å…¥å†…å®¹æˆ–ä¸Šä¼ æ–‡ä»¶
                if (!message && uploadedFiles.length === 0) {
                    alert('è¯·è¾“å…¥é—®é¢˜æˆ–ä¸Šä¼ æ–‡ä»¶');
                    return;
                }

                // è·å–å½“å‰é€‰æ‹©çš„æ¨¡å‹å’ŒAPIå¯†é’¥
                const currentModel = getCurrentModel();
                const currentApiKey = getCurrentApiKey();
                
                // æ£€æŸ¥APIå¯†é’¥æ˜¯å¦ä¸ºç©º
                if (!currentApiKey) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„APIå¯†é’¥');
                    return;
                }

                // æ„é€ ç”¨æˆ·æ¶ˆæ¯å†…å®¹ï¼ŒåŒ…å«æ–‡æœ¬å’Œä¸Šä¼ æ–‡ä»¶ä¿¡æ¯
                let userContent = message;
                if (uploadedFiles.length > 0) {
                    uploadedFiles.forEach((file, index) => {
                        const fileType = file.file.type.includes('image') ? 'å›¾ç‰‡' : 'æ–‡ä»¶';
                        userContent += `\n[å·²ä¸Šä¼ ${fileType}: ${file.file.name}]`;
                        if (file.description) userContent += ` - ${file.description}`;
                    });
                }

                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
                addMessage(userContent, 'user', uploadedFiles);
                input.value = '';
                
                // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
                document.getElementById('loading').classList.add('show');
                
                // åˆ›å»ºè¯·æ±‚æ§åˆ¶å™¨ï¼Œç”¨äºä¸­æ­¢è¯·æ±‚
                const controller = new AbortController();
                currentStreamController = controller;

                // æ ‡è®°æ˜¯å¦å·²å¼€å§‹å¤´åƒåŠ¨ç”»
                let avatarAnimationStarted = false;
                
                // è°ƒç”¨ç¡…åŸºæµåŠ¨APIè·å–AIå“åº”
                const response = await fetch('https://api.siliconflow.cn/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${currentApiKey}`,
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        model: currentModel,
                        messages: [
                            {
                                role: 'system',
                                content: `- ä½ æ˜¯å¢¨è€å¸ˆï¼Œæ±•å¤´æŠ€å¸ˆå­¦é™¢çš„PPTå­¦ä¹ å¯¼å¸ˆï¼Œä¸“é—¨ä¸ºç”¨æˆ·æä¾›å…³äºPPTè®¾è®¡ä¸æ¼”ç¤ºå­¦ä¹ è¿‡ç¨‹ä¸­çš„å¸®åŠ©ä¸æŒ‡å¯¼ã€‚
                                            - ä½ å…·å¤‡ä¸°å¯Œçš„PPTè®¾è®¡ä¸æ¼”ç¤ºçŸ¥è¯†ï¼Œèƒ½å¤Ÿè§£ç­”ç”¨æˆ·åœ¨åˆ¶ä½œã€è®¾è®¡ã€æ¼”ç¤ºPPTæ—¶é‡åˆ°çš„å„ç§é—®é¢˜ã€‚
                                            - ä½ çš„å›ç­”ç¬¬ä¸€æ®µæ˜¯"æˆ‘æ˜¯å¢¨è€å¸ˆï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æé—®é¢˜ï¼š"
                                            - ä½ çš„å›ç­”æ˜¯"ä¸€ã€åˆ†æé—®é¢˜â€”â€”â€”äºŒã€æ¡ˆä¾‹è§£æâ€”â€”â€”ä¸‰ã€å‘æ•£æ€è€ƒ"ä¸‰æ­¥æ³•å¼•å¯¼å­¦ç”Ÿç†è§£çŸ¥è¯†
                                            - å°½é‡ç”¨å›¾æ ‡è¾…åŠ©è¾“å‡ºç»“æœï¼Œä¾‹å¦‚ğŸ¯ï¼ŒğŸ“‹ï¼ŒğŸŒ°ç­‰ç­‰
                                            - åªå›ç­”PPTè®¾è®¡ä¸æ¼”ç¤ºæˆ–è€…æ±•å¤´æŠ€å¸ˆå­¦é™¢çš„ç›¸å…³é—®é¢˜`
                            },
                            {
                                role: 'user',
                                content: userContent
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 2048,
                        stream: true
                    }),
                    signal: controller.signal
                });

                // æ£€æŸ¥APIå“åº”çŠ¶æ€
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`APIè¯·æ±‚å¤±è´¥ (${response.status}): ${errorData.error?.message || response.statusText}`);
                }

                // éšè—åŠ è½½åŠ¨ç”»
                document.getElementById('loading').classList.remove('show');
                
                // åˆ›å»ºAIæ¶ˆæ¯æ˜¾ç¤ºåŒºåŸŸ
                const messageId = 'ai-message-' + Date.now();
                const aiMessageDiv = document.createElement('div');
                aiMessageDiv.className = 'message ai';
                aiMessageDiv.id = messageId;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                contentDiv.innerHTML = '<div class="typing-indicator"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div>';
                
                aiMessageDiv.appendChild(contentDiv);
                document.getElementById('chatArea').appendChild(aiMessageDiv);
                document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
                
                // å¼€å§‹æ•°å­—äººå¤´åƒåŠ¨ç”»
                startAvatarAnimation();
                
                // å¤„ç†æµå¼å“åº”æ•°æ®
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let aiResponse = '';
                
                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ') && line !== 'data: [DONE]') {
                            try {
                                const data = JSON.parse(line.substring(6));
                                if (data.choices && data.choices[0] && data.choices[0].delta && data.choices[0].delta.content) {
                                    aiResponse += data.choices[0].delta.content;
                                    contentDiv.innerHTML = markdownToHtml(aiResponse);
                                    document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
                                }
                            } catch (e) {
                                console.error('è§£ææµæ•°æ®é”™è¯¯:', e);
                            }
                        }
                    }
                }
                
                // ä¿å­˜AIå›å¤å†…å®¹
                lastAiResponse = aiResponse;
                
                // ä¿å­˜å¯¹è¯åˆ°å†å²è®°å½•
                if (userContent && aiResponse) {
                    saveToHistory(userContent, aiResponse);
                }
            } catch (error) {
                // éšè—åŠ è½½åŠ¨ç”»
                document.getElementById('loading').classList.remove('show');
                
                // å¤„ç†ä¸åŒç±»å‹çš„é”™è¯¯
                if (error.name === 'AbortError') {
                    console.log('è¯·æ±‚å·²è¢«ç”¨æˆ·ä¸­æ­¢');
                    addMessage('è¯·æ±‚å·²ä¸­æ­¢', 'ai');
                } else {
                    console.error('APIè°ƒç”¨é”™è¯¯:', error);
                    
                    // æ„é€ é”™è¯¯æ¶ˆæ¯
                    let errorMessage = 'æˆ‘æ˜¯å¢¨è€å¸ˆï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æé—®é¢˜ã€‚æŠ±æ­‰ï¼Œå½“å‰å‡ºç°äº†ä»¥ä¸‹é—®é¢˜ï¼š\n\n';
                    
                    if (error.message.includes('401')) {
                        errorMessage += 'âŒ APIå¯†é’¥æ— æ•ˆï¼Œè¯·æ£€æŸ¥æ‚¨çš„APIå¯†é’¥æ˜¯å¦æ­£ç¡®ã€‚';
                    } else if (error.message.includes('429')) {
                        errorMessage += 'âŒ APIè°ƒç”¨é¢‘ç‡è¶…é™ï¼Œè¯·ç¨åå†è¯•ã€‚';
                    } else if (error.message.includes('500')) {
                        errorMessage += 'âŒ æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åå†è¯•ã€‚';
                    } else if (error.message.includes('ç½‘ç»œ')) {
                        errorMessage += 'âŒ ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚';
                    } else if (error.message.includes('model')) {
                        errorMessage += 'âŒ æ‰€é€‰æ¨¡å‹ä¸å¯ç”¨ï¼Œè¯·å°è¯•å…¶ä»–æ¨¡å‹ã€‚';
                    } else {
                        errorMessage += `âŒ ${error.message}`;
                    }
                    
                    errorMessage += '\n\nğŸ’¡ å»ºè®®ï¼š\n1. ç¡®è®¤APIå¯†é’¥æ­£ç¡®\n2. æ£€æŸ¥ç½‘ç»œè¿æ¥\n3. å°è¯•åˆ‡æ¢å…¶ä»–AIæ¨¡å‹\n4. ç¨åé‡è¯•';
                    
                    addMessage(errorMessage, 'ai');
                    lastAiResponse = errorMessage;
                }
            } finally {
                // é‡ç½®çŠ¶æ€
                isStreaming = false;
                currentStreamController = null;
                sendBtn.disabled = false;
                sendBtn.textContent = 'å‘é€';
                sendBtn.classList.remove('stop');
                
                // åœæ­¢æ•°å­—äººå¤´åƒåŠ¨ç”»å¹¶æ˜¾ç¤ºç¬¬ä¸€å¼ å¤´åƒ
                stopAvatarAnimation();
                
                // æ¸…ç©ºä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
                uploadedFiles = [];
                updateUploadedFilesList();
            }
        }

        /**
         * æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
         * åœ¨èŠå¤©åŒºåŸŸæ˜¾ç¤ºç”¨æˆ·æˆ–AIçš„æ¶ˆæ¯
         * @param {string} content - æ¶ˆæ¯å†…å®¹
         * @param {string} type - æ¶ˆæ¯ç±»å‹ ('user' æˆ– 'ai')
         * @param {Array} files - é™„åŠ çš„æ–‡ä»¶åˆ—è¡¨
         */
        function addMessage(content, type, files = []) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.innerHTML = markdownToHtml(content);
            
            // å¤„ç†é™„åŠ æ–‡ä»¶çš„æ˜¾ç¤º
            files.forEach(file => {
                if (file.file.type.includes('image')) {
                    const imgPreview = document.createElement('img');
                    imgPreview.src = URL.createObjectURL(file.file);
                    imgPreview.className = 'message-image';
                    imgPreview.alt = file.file.name;
                    contentDiv.appendChild(imgPreview);
                } else {
                    const fileLink = document.createElement('div');
                    fileLink.innerHTML = `ğŸ“ <a href="${URL.createObjectURL(file.file)}" target="_blank">${file.file.name}</a> (${formatFileSize(file.file.size)})`;
                    fileLink.style.marginTop = '8px';
                    contentDiv.appendChild(fileLink);
                }
                
                if (file.description) {
                    const descDiv = document.createElement('div');
                    descDiv.className = 'file-description';
                    descDiv.textContent = `æè¿°: ${file.description}`;
                    contentDiv.appendChild(descDiv);
                }
            });
            
            messageDiv.appendChild(contentDiv);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        /**
         * å¿«é€Ÿæé—®
         * å°†å¸¸è§é—®é¢˜å¡«å…¥è¾“å…¥æ¡†å¹¶å‘é€
         * @param {string} question - è¦å‘é€çš„é—®é¢˜
         */
        function askQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }

        /**
         * æ–‡ä»¶ä¸Šä¼ ç›¸å…³å‡½æ•°å’Œå˜é‡
         */
        
        /**
         * å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
         * å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åŠå…¶æè¿°
         * @type {Array}
         */
        let uploadedFiles = [];
        
        /**
         * æ›´æ–°å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
         * æ ¹æ®uploadedFilesæ•°ç»„æ›´æ–°ç•Œé¢ä¸Šçš„æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
         */
        function updateUploadedFilesList() {
            const listContainer = document.getElementById('uploadedFilesList');
            
            if (uploadedFiles.length === 0) {
                listContainer.style.display = 'none';
                return;
            }
            
            listContainer.style.display = 'block';
            listContainer.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const fileType = file.file.type.includes('image') ? 'ğŸ–¼ï¸' : 'ğŸ“';
                const fileItem = document.createElement('div');
                fileItem.className = 'uploaded-file-item';
                
                fileItem.innerHTML = `
                    <span>${fileType}</span>
                    <div class="file-info">
                        <div class="file-name">${file.file.name} (${formatFileSize(file.file.size)})</div>
                        <input type="text" class="file-desc-input" placeholder="æ·»åŠ æè¿°..." 
                               value="${file.description || ''}" data-index="${index}">
                    </div>
                    <span class="remove-file" onclick="removeFile(${index})">Ã—</span>
                `;
                
                listContainer.appendChild(fileItem);
            });
            
            // ä¸ºæ–‡ä»¶æè¿°è¾“å…¥æ¡†ç»‘å®šäº‹ä»¶
            document.querySelectorAll('.file-desc-input').forEach(input => {
                input.addEventListener('input', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    uploadedFiles[index].description = this.value.trim();
                });
            });
        }

        /**
         * ç§»é™¤æ–‡ä»¶
         * ä»ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ä¸­ç§»é™¤æŒ‡å®šæ–‡ä»¶
         * @param {number} index - è¦ç§»é™¤çš„æ–‡ä»¶ç´¢å¼•
         */
        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateUploadedFilesList();
        }

        // è·å–DOMå…ƒç´ å¼•ç”¨
        const fileUpload = document.getElementById('fileUpload');
        const uploadImageBtn = document.getElementById('uploadImageBtn');
        const uploadFileBtn = document.getElementById('uploadFileBtn');

        // ç»‘å®šä¸Šä¼ å›¾ç‰‡æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        uploadImageBtn.addEventListener('click', () => {
            fileUpload.accept = "image/*";
            fileUpload.click();
        });

        // ç»‘å®šä¸Šä¼ æ–‡ä»¶æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        uploadFileBtn.addEventListener('click', () => {
            fileUpload.accept = "application/pdf,.ppt,.pptx,.doc,.docx,.txt,.zip,.tar.gz,image/*";
            fileUpload.click();
        });

        // ç»‘å®šæ–‡ä»¶é€‰æ‹©å˜åŒ–äº‹ä»¶
        fileUpload.addEventListener('change', (e) => {
            const files = e.target.files;
            if (files.length > 0) {
                for (let i = 0; i < files.length; i++) {
                    uploadedFiles.push({
                        file: files[i],
                        description: ''
                    });
                }
                updateUploadedFilesList();
            }
            fileUpload.value = '';
        });

        /**
         * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
         * å°†å­—èŠ‚å¤§å°è½¬æ¢ä¸ºäººç±»å¯è¯»çš„æ ¼å¼
         * @param {number} bytes - æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
         * @return {string} æ ¼å¼åŒ–åçš„æ–‡ä»¶å¤§å°å­—ç¬¦ä¸²
         */
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        /**
         * æ›´æ–°å‘é€æŒ‰é’®çŠ¶æ€
         * æ ¹æ®å½“å‰æµå¼ä¼ è¾“çŠ¶æ€æ›´æ–°å‘é€æŒ‰é’®çš„æ˜¾ç¤ºå’ŒåŠŸèƒ½
         */
        function updateSendButtonState() {
            const sendBtn = document.getElementById('sendBtn');
            if (isStreaming) {
                sendBtn.disabled = false;
                sendBtn.textContent = 'åœæ­¢';
                sendBtn.classList.add('stop');
            } else {
                sendBtn.disabled = false;
                sendBtn.textContent = 'å‘é€';
                sendBtn.classList.remove('stop');
            }
        }

        /**
         * ä½¿ç”¨æµè§ˆå™¨å†…ç½®è¯­éŸ³æ’­æ”¾ï¼ˆé»˜è®¤ç”·äººå£°éŸ³ï¼‰
         * é€šè¿‡Web Speech APIæ’­æ”¾æ–‡æœ¬å†…å®¹
         * @param {string} text - è¦æ’­æ”¾çš„æ–‡æœ¬å†…å®¹
         */
        function playWithWebSpeech(text) {
            // åœæ­¢ä»»ä½•æ­£åœ¨æ’­æ”¾çš„è¯­éŸ³
            stopVoice();
            
            // åˆ›å»ºè¯­éŸ³å®ä¾‹
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-CN';
            
            // ç”·å£°å‚æ•°è®¾ç½®
            utterance.pitch = 1.3;
            utterance.rate = 1.1;
            utterance.volume = 1.0;
            
            // å°è¯•è·å–ç”·å£°
            const voices = window.speechSynthesis.getVoices();
            const maleVoice = voices.find(voice => 
                (voice.lang === 'zh-CN' || voice.lang === 'zh') &&
                (voice.name.includes('Male') || voice.name.includes('ç”·'))
            );
            if (maleVoice) utterance.voice = maleVoice;
            
            // æ’­æ”¾å¼€å§‹æ—¶å¯åŠ¨å¤´åƒåŠ¨ç”»
            utterance.onstart = function() {
                updateVoiceButtonState(true);
                startAvatarAnimation();
            };
            
            // æ’­æ”¾è¯­éŸ³
            window.speechSynthesis.speak(utterance);
            
            // æ’­æ”¾ç»“æŸå›è°ƒ
            utterance.onend = function() {
                updateVoiceButtonState(false);
                stopAvatarAnimation();
            };
            
            utterance.onerror = function() {
                alert('è¯­éŸ³æ’­æ”¾å¤±è´¥ï¼Œè¯·å°è¯•å…¶ä»–æµè§ˆå™¨');
                updateVoiceButtonState(false);
                stopAvatarAnimation();
            };
        }

        /**
         * æ’­æ”¾è¯­éŸ³ï¼ˆç»Ÿä¸€å…¥å£ï¼‰
         * æ’­æ”¾æœ€åä¸€æ¬¡AIå›å¤çš„å†…å®¹
         */
        function playVoice() {
            if (!lastAiResponse) {
                alert('æ²¡æœ‰å¯æ’­æ”¾çš„å›ç­”å†…å®¹');
                return;
            }
            
            // ç›´æ¥ä½¿ç”¨é»˜è®¤çš„ç”·äººå£°éŸ³æ’­æ”¾
            playWithWebSpeech(lastAiResponse);
        }

        /**
         * åœæ­¢è¯­éŸ³
         * åœæ­¢å½“å‰æ­£åœ¨æ’­æ”¾çš„è¯­éŸ³
         */
        function stopVoice() {
            // åœæ­¢æµè§ˆå™¨è¯­éŸ³æ’­æ”¾
            window.speechSynthesis.cancel();
            
            // åœæ­¢å¤´åƒåŠ¨ç”»
            stopAvatarAnimation();
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateVoiceButtonState(false);
        }

        /**
         * æ›´æ–°è¯­éŸ³æŒ‰é’®çŠ¶æ€
         * æ ¹æ®è¯­éŸ³æ’­æ”¾çŠ¶æ€æ›´æ–°ç›¸å…³æŒ‰é’®çš„å¯ç”¨/ç¦ç”¨çŠ¶æ€
         * @param {boolean} isPlaying - æ˜¯å¦æ­£åœ¨æ’­æ”¾è¯­éŸ³
         */
        function updateVoiceButtonState(isPlaying) {
            const playBtn = document.getElementById('playButton');
            const stopBtn = document.getElementById('stopButton');
            
            if (isPlaying) {
                playBtn.disabled = true;
                stopBtn.disabled = false;
            } else {
                playBtn.disabled = !lastAiResponse;
                stopBtn.disabled = true;
            }
        }
    </script>
</body>
</html>